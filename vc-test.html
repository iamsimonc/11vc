<!DOCTYPE html>
<html lang="zh-Hant">
<head>
<meta charset="UTF-8">
<meta name="viewport" content="width=device-width, initial-scale=1.0">
<title>Kathryn 11+ VR ç·šä¸Šæ¸¬é©—</title>
<script src="https://cdnjs.cloudflare.com/ajax/libs/PapaParse/5.3.0/papaparse.min.js"></script>
<style>
:root { --primary:#6c5ce7; --core:#55efc4; --elite:#fd79a8; --bg:#0f172a; --card-bg:#1e293b; --text:#f8fafc;}
body{font-family:Arial,sans-serif;background:var(--bg);color:var(--text);padding:20px;}
.container{max-width:900px;margin:auto;}
.btn{padding:10px 18px;border-radius:8px;border:none;cursor:pointer;font-weight:bold;margin-right:5px;transition:.3s;}
.btn-audio{background:#4b5563;color:white;}
.btn-gen{background:var(--primary);color:white;}
.vocab-card{background:var(--card-bg);padding:20px;border-radius:15px;margin-bottom:20px;border-left:10px solid var(--primary);}
.badge{padding:4px 10px;border-radius:5px;font-size:.8em;font-weight:bold;}
.badge-core{background:var(--core);color:#000;}
.badge-elite{background:var(--elite);color:#fff;}
input[type=text]{padding:5px 8px;border-radius:5px;border:none;width:120px;}
</style>
</head>
<body>
<div class="container">
    <h1>ğŸš€ Kathryn 11+ VR ç·šä¸Šæ¸¬é©—</h1>
    <button class="btn btn-gen" onclick="generateTest()">ğŸ”„ ç”Ÿæˆæœ¬é€±æ¸¬é©—</button>
    <button class="btn" onclick="window.open('https://docs.google.com/spreadsheets/d/YOUR_SHEET_ID_HERE','_blank')">ğŸ“Š æŸ¥çœ‹ Dashboard</button>
    <div id="testArea"></div>
    <button class="btn" onclick="submitTest()">æäº¤æ¸¬é©—</button>
</div>

<script>
let allVocab = [];
let currentWords = [];

// 1. è®€ CSV
window.onload=function(){
    Papa.parse("vocab.csv",{download:true,header:true,skipEmptyLines:true,complete: function(results){
        allVocab = results.data.filter(r=>r.word);
    }});
};

// 2. æ´—ç‰Œ
function shuffle(arr){return arr.sort(()=>Math.random()-0.5);}

// 3. ç”Ÿæˆæœ¬é€±æ¸¬é©—ï¼ˆ5 å­— 70%æ˜“å­— 30%é›£å­—ï¼‰
function generateTest(){
    const cores = allVocab.filter(v=>v.type.toUpperCase()==='CORE');
    const elites = allVocab.filter(v=>v.type.toUpperCase()==='ELITE');
    const coreSample=shuffle(cores).slice(0,3);
    const eliteSample=shuffle(elites).slice(0,2);
    currentWords = shuffle([...coreSample,...eliteSample]);
    renderTest();
}

// 4. æ¸²æŸ“æ¸¬é©—
function renderTest(){
    const area=document.getElementById('testArea');
    area.innerHTML='';
    currentWords.forEach((item,i)=>{
        const typeClass = item.type.toLowerCase()==='core'?'badge-core':'badge-elite';
        area.innerHTML+=`
        <div class="vocab-card">
            <span class="badge ${typeClass}">${item.type}</span>
            <button class="btn-audio" onclick="playAudio('${item.word}')">ğŸ”Š Voice</button>
            <p>Q${i+1}: Spell the word: <span id="word-${i}">${item.word}</span> 
            <button onclick="hideWord(${i})">ğŸ‘ï¸ Hide/Show</button></p>
            <input type="text" id="ans-${i}" placeholder="è¼¸å…¥ç­”æ¡ˆ">
        </div>
        `;
    });
}

// 5. æ’­éŸ³
function playAudio(word){
    const audio=new Audio(`audio/${word}.mp3`);
    audio.play();
}

// 6. éš±è—/é¡¯ç¤º
function hideWord(i){
    const el=document.getElementById(`word-${i}`);
    if(el.innerText!=='â—â—â—'){el.innerText='â—â—â—';}else{el.innerText=currentWords[i].word;}
}

// 7. æäº¤æ¸¬é©—
function submitTest(){
    let score=0;
    currentWords.forEach((item,i)=>{
        const ans=document.getElementById(`ans-${i}`).value.trim().toUpperCase();
        if(ans===item.word.toUpperCase()) score++;
        // ç™¼é€æ¯å€‹å­—çµæœåˆ° Apps Script
        fetch('https://script.google.com/macros/s/AKfycbyVKRndDLY1M46DBzCQV79UWU6EsQBiP33VWK6HAqNWMnWfT-D5Ck3SjOrQ0vyS9NF29Q/exec',{
            method:'POST',
            mode:'no-cors',
            headers:{'Content-Type':'application/json'},
            body:JSON.stringify({
                name:'Kathryn',
                date:new Date().toLocaleString(),
                word:item.word,
                answer:ans,
                correct:item.word,
                score:ans===item.word.toUpperCase()?1:0
            })
        });
    });
    alert(`ä½ å¾—åˆ† ${score}/${currentWords.length} (${Math.round(score/currentWords.length*100)}%)`);
}
</script>
</body>
</html>
