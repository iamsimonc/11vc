<!DOCTYPE html>
<html lang="zh-Hant">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Kathryn 11+ Vocab Master (Testing Mode)</title>
    <script src="https://cdnjs.cloudflare.com/ajax/libs/PapaParse/5.3.0/papaparse.min.js"></script>
    <style>
        :root {
            --primary: #6c5ce7;
            --core: #55efc4;
            --elite: #fd79a8;
            --bg: #0f172a;
            --card-bg: #1e293b;
            --text: #f8fafc;
        }

        body { font-family: 'Segoe UI', sans-serif; background: var(--bg); color: var(--text); padding: 20px; }
        .container { max-width: 800px; margin: auto; }

        /* æ¨™ç±¤æ¨£å¼ */
        .badge { padding: 4px 8px; border-radius: 4px; font-size: 0.8em; font-weight: bold; margin-bottom: 10px; display: inline-block; }
        .badge-core { background: var(--core); color: #000; }
        .badge-elite { background: var(--elite); color: #fff; }

        /* æ§åˆ¶é¢æ¿ */
        .controls { background: var(--card-bg); padding: 20px; border-radius: 12px; display: flex; gap: 10px; margin-bottom: 20px; align-items: center; }
        input { padding: 10px; border-radius: 6px; border: none; width: 60px; text-align: center; }
        button { padding: 10px 15px; border-radius: 8px; border: none; cursor: pointer; font-weight: bold; }
        .btn-gen { background: var(--primary); color: white; }
        .btn-print { background: #00b894; color: white; }
        .btn-audio { background: #4b5563; color: white; font-size: 1.2em; }

        /* å¡ç‰‡æ¨£å¼ */
        .vocab-card { background: var(--card-bg); margin-bottom: 20px; padding: 25px; border-radius: 12px; position: relative; border-left: 6px solid var(--primary); }
        .test-hint { display: none; font-style: italic; color: #666; }

        /* èªéŸ³é¸æ“‡å™¨ï¼ˆéš±è—ä½†å­˜åœ¨ï¼‰ */
        #voiceSelect { display: none; }

        /* ğŸ–¨ï¸ åˆ—å°æ¸¬è©¦ç´™æ¨¡å¼ï¼šéš±è—ç­”æ¡ˆ */
        @media print {
            @page { margin: 1cm; }
            .no-print { display: none !important; }
            body { background: white; color: black; }
            .vocab-card { border: 1px solid #000; background: white; page-break-inside: avoid; margin-bottom: 30px; }
            
            /* éš±è—ç­”æ¡ˆå…§å®¹ */
            .word-title, .word-detail { display: none !important; }
            /* é¡¯ç¤ºæ¸¬è©¦ç”¨çš„æç¤º */
            .test-hint { display: block !important; border-bottom: 1px solid #000; margin-top: 10px; height: 30px; }
            .test-label { font-weight: bold; font-size: 1.2em; }
        }
    </style>
</head>
<body>

<div class="container">
    <div class="no-print">
        <h2 style="color:var(--secondary)">ğŸŒŸ Kathryn 11+ Vocab Master</h2>
        <div class="controls">
            <label>Week:</label>
            <input type="number" id="weekInput" value="1" min="1">
            <button class="btn-gen" onclick="generateByWeek()">ç”Ÿæˆç·´ç¿’</button>
            <button class="btn-print" onclick="window.print()">åˆ—å°æ¸¬è©¦ç´™</button>
            <select id="voiceSelect"></select> </div>
        <p style="color: #aaa; font-size: 0.9em;">* åˆ—å°æ™‚æœƒè‡ªå‹•è½‰ç‚ºæ¸¬è©¦æ¨¡å¼ï¼ˆéš±è—ç­”æ¡ˆï¼Œåƒ…ç•™é¦–å­—æ¯æç¤ºï¼‰ã€‚</p>
    </div>

    <div id="vocabList"></div>
</div>

<script>
    let allVocab = [];
    let currentWeekWords = [];
    let synth = window.speechSynthesis;

    // 1. åˆå§‹åŒ–äººè²é¸æ“‡ï¼ˆè‡ªå‹•æŒ‘é¸é«˜å“è³ªè‹±å¼äººè²ï¼‰
    function loadVoices() {
        const voices = synth.getVoices();
        const select = document.getElementById('voiceSelect');
        // å„ªå…ˆé †åºï¼šGoogle UK English Female > Microsoft Hazel > Any UK English
        let bestVoice = voices.find(v => v.name.includes('Google UK English Female')) || 
                        voices.find(v => v.name.includes('Hazel')) ||
                        voices.find(v => v.lang === 'en-GB');
        
        if (bestVoice) {
            window.selectedVoice = bestVoice;
        }
    }
    if (speechSynthesis.onvoiceschanged !== undefined) {
        speechSynthesis.onvoiceschanged = loadVoices;
    }

    // 2. è¼‰å…¥ CSV
    window.onload = function() {
        Papa.parse("vocab.csv", {
            download: true,
            header: true,
            complete: function(results) {
                allVocab = results.data.filter(row => row.word);
                loadVoices();
                generateByWeek();
            }
        });
    };

    // 3. æŒ‰é€±æ¬¡æŠ½å– (7 Core : 3 Elite)
    function generateByWeek() {
        const week = parseInt(document.getElementById('weekInput').value) || 1;
        const cores = allVocab.filter(v => v.type.toUpperCase() === 'CORE');
        const elites = allVocab.filter(v => v.type.toUpperCase() === 'ELITE');

        // æ¯é€±è·³éæ•¸é‡ä»¥é˜²é‡è¤‡
        let selectedCores = cores.slice((week-1)*7, (week-1)*7 + 7);
        let selectedElites = elites.slice((week-1)*3, (week-1)*3 + 3);

        currentWeekWords = [...selectedCores, ...selectedElites];
        renderCards();
    }

    // 4. æ¸²æŸ“å¡ç‰‡
    function renderCards() {
        const listDiv = document.getElementById('vocabList');
        listDiv.innerHTML = '';

        currentWeekWords.forEach((item, index) => {
            const typeClass = item.type.toLowerCase() === 'core' ? 'badge-core' : 'badge-elite';
            const firstLetter = item.word.charAt(0);
            const wordLen = item.word.length;

            const card = document.createElement('div');
            card.className = 'vocab-card';
            card.innerHTML = `
                <div class="badge ${typeClass}">${item.type}</div>
                <button class="btn-audio no-print" onclick="playAudio('${item.word}')">ğŸ”Š æ’­æ”¾è®€éŸ³</button>
                
                <h2 class="word-title">${index + 1}. ${item.word}</h2>
                <div class="word-detail">
                    <p><strong>ğŸ’¡ Memory:</strong> ${item.memory || 'N/A'}</p>
                    <p><strong>ğŸ”— Syn:</strong> ${item.syn} | <strong>ğŸš« Ant:</strong> ${item.ant}</p>
                </div>

                <div class="test-hint">
                    <span class="test-label">Q${index + 1}. æç¤º: ${item.syn} (åç¾©: ${item.ant})</span>
                    <p>è«‹æ‹¼å¯«å‡ºé€™å€‹å­— ( ${firstLetter}... , å…± ${wordLen} å€‹å­—æ¯ ):</p>
                    <div style="height:40px; border-bottom: 2px dashed #000; width: 100%;"></div>
                </div>
            `;
            listDiv.appendChild(card);
        });
    }

    // 5. é«˜å“è³ªèªéŸ³æ’­æ”¾
    function playAudio(text) {
        synth.cancel(); // åœæ­¢ç•¶å‰æ­£åœ¨æ’­æ”¾çš„è²éŸ³
        const utterance = new SpeechSynthesisUtterance(text);
        
        if (window.selectedVoice) {
            utterance.voice = window.selectedVoice;
        }
        utterance.lang = 'en-GB';
        utterance.rate = 0.8; // ç¨æ…¢ä¸€é»ç¢ºä¿æ¸…æ™°
        utterance.pitch = 1.0;
        synth.speak(utterance);
    }
</script>

</body>
</html>
