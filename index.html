<!DOCTYPE html>
<html lang="zh-Hant">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Kathryn 11+ Vocab Master (Professional Edition)</title>
    <script src="https://cdnjs.cloudflare.com/ajax/libs/PapaParse/5.3.0/papaparse.min.js"></script>
    <style>
        :root {
            --primary: #6c5ce7;
            --core: #55efc4;
            --elite: #fd79a8;
            --bg: #0f172a;
            --card-bg: #1e293b;
            --text: #f8fafc;
        }

        body { font-family: 'Arial', sans-serif; background: var(--bg); color: var(--text); padding: 20px; }
        .container { max-width: 850px; margin: auto; }

        /* æ¨™ç±¤ */
        .badge { padding: 4px 10px; border-radius: 4px; font-size: 0.85em; font-weight: bold; margin-bottom: 12px; display: inline-block; }
        .badge-core { background: var(--core); color: #000; }
        .badge-elite { background: var(--elite); color: #fff; }

        /* æ§åˆ¶é¢æ¿ */
        .controls { background: var(--card-bg); padding: 25px; border-radius: 12px; display: flex; gap: 12px; margin-bottom: 25px; align-items: center; border: 1px solid #334155; }
        input { padding: 10px; border-radius: 6px; border: 1px solid #334155; background: #0f172a; color: white; width: 60px; text-align: center; font-size: 1.1em; }
        button { padding: 12px 20px; border-radius: 8px; border: none; cursor: pointer; font-weight: bold; transition: 0.2s; }
        .btn-gen { background: var(--primary); color: white; }
        .btn-print { background: #00b894; color: white; }
        .btn-audio { background: #4b5563; color: white; margin-bottom: 10px; display: flex; align-items: center; gap: 5px; }
        button:hover { opacity: 0.9; transform: translateY(-1px); }

        /* ç·´ç¿’å¡ç‰‡ */
        .vocab-card { background: var(--card-bg); margin-bottom: 20px; padding: 25px; border-radius: 15px; border-left: 8px solid var(--primary); box-shadow: 0 4px 6px -1px rgba(0,0,0,0.1); }
        .test-content { display: none; } /* é è¨­éš±è—æ¸¬è©¦å…§å®¹ */

        /* ğŸ–¨ï¸ åˆ—å°/æ¸¬è©¦æ¨¡å¼ä¿®å¾© */
        @media print {
            body { background: white !important; color: black !important; padding: 0; }
            .no-print { display: none !important; }
            .container { max-width: 100%; }
            .vocab-card { 
                background: white !important; 
                border: 2px solid #eee !important; 
                border-left: 8px solid #333 !important;
                page-break-inside: avoid; 
                margin-bottom: 40px; 
                color: black !important;
                padding: 20px;
            }
            .word-info { display: none !important; } /* éš±è—ç­”æ¡ˆ */
            .test-content { display: block !important; } /* é¡¯ç¤ºé¡Œç›® */
            
            .test-q { font-size: 1.3em; font-weight: bold; margin-bottom: 15px; display: block; }
            .test-hint { font-size: 1.1em; color: #333; margin-bottom: 15px; line-height: 1.6; }
            .answer-line { 
                margin-top: 25px;
                border-bottom: 2px solid #000; 
                height: 40px; 
                width: 100%;
                position: relative;
            }
            .answer-line::after { content: "Sign: ________________"; position: absolute; right: 0; bottom: -25px; font-size: 0.8em; color: #666; }
        }
    </style>
</head>
<body>

<div class="container">
    <div class="no-print">
        <h1 style="color:var(--secondary); margin-bottom:5px;">ğŸ“ Kathryn 11+ Vocab Master</h1>
        <p style="color:#94a3b8; margin-top:0;">ç›®å‰å·²å„²å­˜æ‚¨çš„è­·çœ¼èˆ‡æ·±è‰²æ¨¡å¼åå¥½ã€‚</p>
        
        <div class="controls">
            <label>é¸æ“‡é€±æ¬¡ (Week):</label>
            <input type="number" id="weekInput" value="1" min="1">
            <button class="btn-gen" onclick="generateByWeek()">ğŸ”„ æ›´æ–°å–®å­—</button>
            <button class="btn-print" onclick="window.print()">ğŸ–¨ï¸ ç”Ÿæˆæ¸¬è©¦ç´™</button>
        </div>
    </div>

    <div id="vocabList"></div>
</div>

<script>
    let allVocab = [];
    let currentWeekWords = [];

    // 1. é«˜å“è³ªèªéŸ³é‚è¼¯
    function speak(text) {
        window.speechSynthesis.cancel();
        const msg = new SpeechSynthesisUtterance(text);
        const voices = window.speechSynthesis.getVoices();
        // å°‹æ‰¾è‹±å¼å¥³è²æˆ– Google é«˜å“è³ªèªéŸ³
        msg.voice = voices.find(v => v.name.includes('Google UK English Female')) || 
                    voices.find(v => v.lang === 'en-GB') || 
                    voices[0];
        msg.rate = 0.8;
        msg.pitch = 1.0;
        window.speechSynthesis.speak(msg);
    }

    // åˆå§‹åŒ–èªéŸ³
    window.speechSynthesis.onvoiceschanged = () => window.speechSynthesis.getVoices();

    // 2. è¼‰å…¥æ•¸æ“š
    window.onload = function() {
        Papa.parse("vocab.csv", {
            download: true,
            header: true,
            skipEmptyLines: true,
            complete: function(results) {
                allVocab = results.data.filter(row => row.word);
                generateByWeek();
            }
        });
    };

    // 3. æ ¸å¿ƒæŠ½å–é‚è¼¯ (7:3)
    function generateByWeek() {
        const week = parseInt(document.getElementById('weekInput').value) || 1;
        const cores = allVocab.filter(v => v.type.toUpperCase() === 'CORE');
        const elites = allVocab.filter(v => v.type.toUpperCase() === 'ELITE');

        // è¨ˆç®—åç§»é‡ä»¥ç¢ºä¿ä¸é‡è¤‡
        const startC = (week - 1) * 7;
        const startE = (week - 1) * 3;

        if (startC >= cores.length) {
            alert("å·²è¶…é Core å–®å­—åº«ä¸Šé™ï¼Œè«‹å˜—è©¦è¼ƒå°çš„ Week æ•¸ã€‚");
            return;
        }

        currentWeekWords = [
            ...cores.slice(startC, startC + 7),
            ...elites.slice(startE, startE + 3)
        ];
        renderCards();
    }

    // 4. æ¸²æŸ“é é¢
    function renderCards() {
        const listDiv = document.getElementById('vocabList');
        listDiv.innerHTML = '';

        currentWeekWords.forEach((item, index) => {
            const typeClass = item.type.toLowerCase() === 'core' ? 'badge-core' : 'badge-elite';
            const firstLetter = item.word.charAt(0).toUpperCase();
            
            const card = document.createElement('div');
            card.className = 'vocab-card';
            card.innerHTML = `
                <div class="word-info">
                    <div class="badge ${typeClass}">${item.type}</div>
                    <button class="btn-audio no-print" onclick="speak('${item.word}')">ğŸ”Š æ’­æ”¾è®€éŸ³</button>
                    <h2 style="margin: 10px 0;">${index + 1}. ${item.word}</h2>
                    <p><strong>ã€è¨˜æ†¶ã€‘</strong> ${item.memory || 'å°šç„¡å‚™è¨»'}</p>
                    <p><strong>ã€åŒç¾©ã€‘</strong> ${item.syn} ï½œ <strong>ã€åç¾©ã€‘</strong> ${item.ant}</p>
                </div>

                <div class="test-content">
                    <span class="test-q">Question ${index + 1} (${item.type})</span>
                    <div class="test-hint">
                        <strong>æç¤ºï¼š</strong> ${item.syn} (åç¾©è©: ${item.ant})<br>
                        <strong>æ‹¼å¯«æç¤ºï¼š</strong> ä»¥ <b>"${firstLetter}"</b> é–‹é ­ï¼Œå…± <b>${item.word.length}</b> å€‹å­—æ¯ã€‚
                    </div>
                    <div class="answer-line"></div>
                </div>
            `;
            listDiv.appendChild(card);
        });
    }
</script>

</body>
</html>
