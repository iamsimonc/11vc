<!-- åªé¡¯ç¤ºã€Œæœ‰ä¿®æ”¹æˆ–æ–°å¢ JS / HTMLã€ï¼ŒCSS èˆ‡å…¶é¤˜çµæ§‹ä¿æŒ -->

<script>
const SCRIPT_URL =
"https://script.google.com/macros/s/AKfycbxPeeeBTqiT2-MFsH4R_aHTPOdGZTeNicNJWMA4qG1jGasJHjpi_as_cUGoeS_Y3Ck8sg/exec";

function shuffleArray(arr) {
  return [...arr].sort(() => Math.random() - 0.5);
}

function sendResult(week, correct, answer, index) {
  fetch(SCRIPT_URL, {
    method: "POST",
    mode: "no-cors",
    headers: { "Content-Type": "application/json" },
    body: JSON.stringify({
      week,
      correct,
      answer,
      index,
      time: new Date().toISOString()
    })
  });
}

/* ğŸ” æ”¹ç‚º 3 CORE + 2 ELITE */
function generateByWeek() {
  const week = parseInt(document.getElementById('weekInput').value) || 1;
  const cores = allVocab.filter(v => v.type.toUpperCase() === 'CORE');
  const elites = allVocab.filter(v => v.type.toUpperCase() === 'ELITE');

  const seedShuffle = (arr, seed) => {
    let m = arr.length, t, i;
    while (m) {
      i = Math.floor(Math.abs(Math.sin(seed++)) * m--);
      t = arr[m]; arr[m] = arr[i]; arr[i] = t;
    }
    return arr;
  };

  const startC = (week - 1) * 3;
  const startE = (week - 1) * 2;

  let poolC = seedShuffle([...cores], week).slice(startC, startC + 3);
  let poolE = seedShuffle([...elites], week + 50).slice(startE, startE + 2);

  currentWords = seedShuffle([...poolC, ...poolE], week + 99);
  render();
}

function render() {
  const display = document.getElementById('mainDisplay');
  display.innerHTML = '';

  currentWords.forEach((item, i) => {
    const word = item.word.toUpperCase();
    const letters = shuffleArray(word.split(''));

    const card = document.createElement('div');
    card.innerHTML = `
<div class="vocab-card web-interactive-area">

<div id="learn-view-${i}">
<h2>${i+1}. ${item.word}</h2>
</div>

<div id="challenge-view-${i}" style="display:none;text-align:center">
<p style="color:#fd79a8;font-weight:bold">ğŸ§© æ‹¼å­—æŒ‘æˆ°</p>

<div id="answer-${i}" style="font-size:2em;min-height:40px;margin:10px 0;"></div>

<div id="letters-${i}">
${letters.map(l=>`<button class="btn" onclick="pickLetter(${i},'${l}')">${l}</button>`).join('')}
</div>

<div style="margin-top:10px">
<button class="btn" onclick="backspace(${i})">âŒ«</button>
<button class="btn btn-gen" onclick="submitAnswer(${i},'${word}')">âœ… Submit</button>
</div>
</div>

<button class="btn" id="btn-toggle-${i}" onclick="toggleChallenge(${i})"
style="width:100%;margin-top:15px;background:#6c5ce7">
ğŸ¯ Start Challenge
</button>

</div>`;
    display.appendChild(card);
  });
}

const answers = {};

function pickLetter(i, l) {
  answers[i] = (answers[i] || "") + l;
  document.getElementById(`answer-${i}`).innerText = answers[i];
}

function backspace(i) {
  answers[i] = (answers[i] || "").slice(0, -1);
  document.getElementById(`answer-${i}`).innerText = answers[i];
}

function submitAnswer(i, correct) {
  const week = document.getElementById('weekInput').value;
  const ans = answers[i] || "";
  sendResult(week, correct, ans, i+1);

  document.getElementById(`letters-${i}`).innerHTML = "âœ… å·²æäº¤";
}

</script>
